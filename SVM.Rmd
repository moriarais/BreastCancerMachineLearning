---
title: "RNAseq"
author: "Shira, Moria, Naama"
date: "2023-06-22"
output: html_document
---
## Libraries

```{r setup, include=FALSE}
library(googledrive)
library(corrplot)
library(ggplot2)
library(randomForest)
library(caret)
library(readr)
library(class)
library(RColorBrewer)
library(FNN)
library(cluster)
library(survival)
library(survminer)
library(ggpubr)
library(dplyr)
library(httr)
```

## For first time, please uncomment the following code and run:

```{r}

# # If its the first time runing the code on your devise: 
# drive_auth()
# 
# # clinical data
# url="https://drive.google.com/file/d/1sIeLwzRQvszjkUNsefTtVdhS74Y09zbz/view?usp=sharing"
# drive_download(url,overwrite=TRUE)
# 
# # Rna seq
# url="https://drive.google.com/file/d/1Ecqg0itgMpaVxuy3lbQt_OHQm77JQpif/view?usp=sharing"
# drive_download(url,overwrite=TRUE)
# 
# # mutations
# url="https://drive.google.com/file/d/1165vt_jwnRiXLBHmGyC1XAobGGSPQXRt/view?usp=sharing"
# drive_download(url,overwrite=TRUE)
# 
# url="https://drive.google.com/file/d/1_98OI7FKtb_Ky3lHyh0QwYPt43xYZkF2/view?usp=sharing"
# drive_download(url,overwrite=TRUE)
# 
# 
# url="https://drive.google.com/file/d/10tB0PeVkCKiTa85e1Ynnq1rTHvt68lGJ/view?usp=sharing"
# drive_auth()
```

## Clinical Data
## brca_tcga_clinical_data.tsv

```{r}
Breast_cancer <- read.delim("brca_tcga_clinical_data.tsv")
```

## Examinations from the experiments 
## Breast_cancer_staging_V2.csv

```{r}
bc_data <- read.csv("Breast_cancer_staging_V2.csv")
head(bc_data)
```

## Normalized RNA sequencing
## scaled_x_rna_seq2.csv

```{r}
scaled_data <- read.csv("scaled_x_rna_seq2.csv")
dim(scaled_data)
head(scaled_data)
```

```{r}
# Printing the features (column names)
features <- colnames(bc_data)
print(features)
```


## Mutations Types
## y_mutations

```{r}
y_mutations <- read.csv("y_mutations2.csv")
dim(y_mutations)
head(y_mutations)
```
# bc_data_df from the file:Breast_cancer_staging_V2.csv
```{r}
head(bc_data$breast_carcinoma_progesterone_receptor_status.x)
  
subtype_df <- subset(bc_data, select =
                       c(bcr_patient_barcode,subtype_BRCA_Subtype_PAM50,breast_carcinoma_estrogen_receptor_status.x,
                         breast_carcinoma_progesterone_receptor_status.x,lab_proc_her2_neu_immunohistochemistry_receptor_status.x))

colnames(subtype_df) <- c("id", "subtype", "estrogen_receptor","progesterone_receptor","her2_receptor")
head(subtype_df)
```

```{r}

sub_rna <- subset(subtype_df, select = c(id,progesterone_receptor))
head(sub_rna)

RNAseq_data_pr <- merge(scaled_data, sub_rna, by.x = "X", by.y = "id")

RNAseq_data_pr <- na.omit(RNAseq_data_pr)

head(RNAseq_data_pr)
rna_data_rf<- RNAseq_data_pr[,2:56499]
pr_status <- RNAseq_data_pr$progesterone_receptor
pr_status <- factor(pr_status)
```

## SVM

wbcd_train_z <- wbcd_z[1:455, ]
wbcd_test_z <- wbcd_z[456:569, ]
wbcd_train_labels_z <- wbcd[1:455, 1]
wbcd_test_labels_z <- wbcd[456:569, 1]
wbcd_test_pred_z <- knn(train = wbcd_train_z, test = wbcd_test_z, cl = wbcd_train_labels_z, k=21)
CrossTable(x = wbcd_test_labels_z, y = wbcd_test_pred_z, prop.chisq=FALSE)


```{r}

# unique((RNAseq_data_subtype$subtype))
rna_matrix <- as.matrix(rna_data_rf)

# Convert class labels to factor if they are not already
class_labels <- factor(RNAseq_data_subtype$subtype)

# Split the data into training and testing sets
set.seed(123)  # For reproducibility
train_indices <- sample(1:nrow(rna_matrix), nrow(rna_matrix) * 0.7)  # 70% for training
train_data <- rna_matrix[train_indices, ]
train_labels <- class_labels[train_indices,]
test_data <- rna_matrix[-train_indices, ]
test_labels <- class_labels[-train_indices, ]

class_labels

```


```{r}
# Train the SVM model
library(e1071)

# Train the SVM model
svm_model <- svm(train_data, train_labels)

# Predict on the test data
svm_pred <- predict(svm_model, test_data)

```

```{r}
# Calculate accuracy
accuracy <- sum(svm_pred == test_labels) / length(test_labels)
print(paste("Accuracy:", accuracy))

```


```{r}
# Check for missing values in test_labels
missing_values <- sum(is.na(test_labels))
print(paste("Number of missing values in test_labels:", missing_values))

```
```{r}
# Assuming 'train_data' and 'test_data' are your training and testing datasets
num_train_columns <- ncol(train_data)
num_test_columns <- ncol(test_data)

if (num_train_columns == num_test_columns) {
  print("Both training and testing datasets have the same number of columns.")
} else {
  print("Number of columns in training and testing datasets do not match.")
}

```

```{r}
# Assuming 'train_data' and 'test_data' are your training and testing datasets
train_columns <- colnames(train_data)
test_columns <- colnames(test_data)

if (identical(train_columns, test_columns)) {
  print("Both training and testing datasets have the same column names.")
} else {
  print("Column names of training and testing datasets do not match.")
}

```



```{r}
# Create a confusion matrix
conf_matrix <- table(Actual = test_labels, Predicted = svm_pred)
print("Confusion Matrix:")
print(conf_matrix)

```


```{r}

precision <- confusionMatrix(svm_pred, test_labels)$byClass["Pos Pred Value"]
recall <- confusionMatrix(svm_pred, test_labels)$byClass["Sens"]
f1_score <- confusionMatrix(svm_pred, test_labels)$byClass["F1"]

print(paste("Precision:", precision))
print(paste("Recall:", recall))
print(paste("F1-score:", f1_score))

```

