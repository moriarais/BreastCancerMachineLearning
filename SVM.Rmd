---
title: "SVM",
author: "Shira, Moria, Naama"
output: pdf_document
date: "2023-07-22"
---

## Libraries

```{r setup, include=FALSE}
library(googledrive)
library(corrplot)
library(ggplot2)
library(randomForest)
library(caret)
library(readr)
library(class)
library(RColorBrewer)
library(FNN)
library(cluster)
library(survival)
library(survminer)
library(ggpubr)
library(dplyr)
library(httr)
```

```{r}
Breast_cancer <- read.delim("brca_tcga_clinical_data.tsv")
```

```{r}
bc_data<- read.csv("Breast_cancer_staging_V2.csv")
head(bc_data)
```


```{r message=TRUE, warning=TRUE}
scaled_data <- read.csv("scaled_x_rna_seq2.csv")
```


```{r message=TRUE, warning=TRUE}
y_mutations <- read.csv("y_mutations2.csv")
```



```{r}
head(bc_data$breast_carcinoma_progesterone_receptor_status.x)
  
subtype_df <- subset(bc_data, select =
                       c(bcr_patient_barcode,subtype_BRCA_Subtype_PAM50,breast_carcinoma_estrogen_receptor_status.x,
                         breast_carcinoma_progesterone_receptor_status.x,lab_proc_her2_neu_immunohistochemistry_receptor_status.x))

colnames(subtype_df) <- c("id", "subtype", "estrogen_receptor","progesterone_receptor","her2_receptor")
head(subtype_df)
```

```{r}

RNAseq_data_survival <- merge(scaled_data, subset(Breast_cancer, select = c(Patient.ID,Overall.Survival.Status)), by.x = "X", by.y = "Patient.ID")
RNAseq_data_survival <- na.omit(RNAseq_data_survival)

head(RNAseq_data_survival)
data_rna_survival <- RNAseq_data_survival[,2:56500]
head(colnames(data_rna_survival))
```


## SVM 

```{r}

# Split the data into training and testing sets (you may need to install the 'caret' package for this)
library(caret)
set.seed(123) # For reproducibility
index <- createDataPartition(class_labels, p = 0.7, list = FALSE)
train_data <- rna_matrix[index, ]
test_data <- rna_matrix[-index, ]
train_labels <- class_labels[index]
test_labels <- class_labels[-index]

# Train the SVM model
library(e1071) # Load the package for SVM
svm_model <- svm(train_data, train_labels)

# Predict on the test data
svm_pred <- predict(svm_model, test_data)

# Create a data frame with PCA results, SVM predicted labels, and true class labels
svm_data <- data.frame(PC1 = pca$x[-index, 1], PC2 = pca$x[-index, 2], Predicted_Class = factor(svm_pred), Class = factor(test_labels))

# Define colors for the class labels
class_colors <- c("Positive" = "blue", "Negative" = "red", "NA" = "green", "Indeterminate" = "orange")

# Plot PCA with SVM predicted labels and true class labels
ggplot(svm_data, aes(x = PC1, y = PC2, color = Class, shape = Predicted_Class)) +
  geom_point() +
  labs(title = "RNA-seq Data Classification using SVM") +
  scale_color_manual(values = class_colors) +
  guides(shape = guide_legend(title = "SVM Predicted Class"), color = guide_legend(title = "True Class"))

```

