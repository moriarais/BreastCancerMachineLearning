---
title: "Main data handling"
author: "Shira, Moria, Naama"
date: "2023-07-24"
output: html_document
---

```{r setup, include=FALSE}
library(googledrive)
library(glmnetUtils)
library(corrplot)
library(randomForest)
library("devtools")
library("factoextra")
library(ggplot2)
library(rpart)
library(e1071)
library(randomForest)
library(caret)
library(readr)
library(class)
library(RColorBrewer)
library(FNN)
library(cluster)
library(survival)
library(survminer)
library(ggpubr)
library(dplyr)
library(httr)
```

## Read data

# Clinical data

```{r}
Breast_cancer <- read.delim("brca_tcga_clinical_data.tsv")
head(Breast_cancer)
```
# Breast cancer staging data

```{r}
bc_data<- read.csv("Breast_cancer_staging_V2.csv")
head(bc_data)
```

# Scaled RNA-seq data

```{r}
scaled_data <- read.csv("scaled_x_rna_seq2.csv")
dim(scaled_data)
head(scaled_data)
```


```{r}
head(bc_data$breast_carcinoma_progesterone_receptor_status.x)
  
subtype_df <- subset(bc_data, select =
                       c(bcr_patient_barcode,subtype_BRCA_Subtype_PAM50,breast_carcinoma_estrogen_receptor_status.x,
                         breast_carcinoma_progesterone_receptor_status.x,lab_proc_her2_neu_immunohistochemistry_receptor_status.x))

colnames(subtype_df) <- c("id", "subtype", "estrogen_receptor","progesterone_receptor","her2_receptor")
head(subtype_df)

# Remove rows with NA values from the RNA-seq data
subtype_df <- na.omit(subtype_df)
dim(subtype_df)

subtype_smaller_df<-subset(subtype_df, subtype_df$her2_receptor != "Equivocal")   # Apply subset function
dim(subtype_smaller_df)
```

# Merge RNA-seq data with receptor subtype data

```{r}
subtype_data <- subset(subtype_df, select = c(id,subtype))
head(subtype_data)

her2_data <- subset(subtype_df, select = c(id,her2_receptor))
head(her2_data)

progesterone_data <- subset(subtype_df, select = c(id,progesterone_receptor))
head(progesterone_data)

estrogen_data <- subset(subtype_df, select = c(id,estrogen_receptor))
head(estrogen_data)

scaled_data<-na.omit(scaled_data)
     
RNAseq_data_subtype <- merge(scaled_data, subtype_data, by.x = "X", by.y = "id")

filtered_data<-merge(scaled_data,subtype_smaller_df, by.x = "X", by.y = "id")
```

## PCA (Principal Component Analysis)

This analysis can be insightful in understanding the variation in the RNA-seq data and how it relates to the different receptor subtypes.

```{r}
pca <- prcomp(subset(RNAseq_data_estrogen, select = -c(X, estrogen_receptor)))
```


```{r,warning=FALSE}
p <- fviz_pca_ind(pca, label="none", habillage=RNAseq_data_subtype$subtype,
             addEllipses=TRUE, ellipse.level=0.95)
print(p)
```



```{r}
data<-merge(scaled_data, subtype_df, by.x = "X", by.y = "id")
numeric_data<-(subset(data, select = -c(X, subtype,estrogen_receptor,progesterone_receptor,her2_receptor)))
head(numeric_data)
```


```{r}
dim(pca$x)

pca_data <- data.frame(pca$x, RNAseq_data_subtype$subtype)

head(pca_data)
```
# Splitting Data into Training and Testing Sets

```{r}
set.seed(123)

data_indices <- seq_len(nrow(numeric_data))

# Sample 70% of the row indices for the training set
train_indices <- sample(data_indices, size = 0.7 * nrow(numeric_data))

# Create the training set using the sampled row indices
train_data <- numeric_data[train_indices, ]

# Create the testing set by excluding the training set row indices
test_data <- numeric_data[-train_indices, ]

train_labels_subtype <- as.factor(data$subtype[train_indices])
test_labels_subtype <- data$subtype[-train_indices]
```

# Run what ever algo you need to :)















